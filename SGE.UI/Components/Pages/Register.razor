@page "/register"
@using SGE.Aplicacion
@inject NavigationManager Navigation
@using SGE.Repositorios
@namespace SGE.Aplicacion.CasosDeUso
@rendermode InteractiveServer
@inject CasoDeUsoUsuarioAlta casoDeUsoUsuarioAlta
@inject ManejarLogin manejarLogin
<PageTitle>Registrarse</PageTitle>
<h3>Registrarse</h3>

<div class="form-group">
    <label>Nombre:</label>
    <input type="text" @bind="user.Nombre" class="form-control margin" />
    <label>Apellido:</label>
    <input type="text" @bind="user.Apellido" class="form-control margin" />
    <label>Correo electr칩nico:</label>
    <input type="text" @bind="user.CorreoElectronico" class="form-control margin" />
    <label>Contrase침a:</label>
    <input type="password" id="contrase침a" @bind="user.Contrase침a" class="form-control margin" />
</div>
<button type="submit" @onclick="Agregar" class="btn btn-primary margin">Registrar</button>

@if (mensajeError != "")
{
    <div class="alert alert-danger margin alinear" role="alert">

        <strong>Error!</strong> @mensajeError.
        <button type="button" class="close" @onclick="CerrarError">x</button>
    </div>
}


@code
{

    private Usuario user = new();
    private string mensajeError = "";
    private void CerrarError() => mensajeError = "";


    private void Agregar()
    {

        try
        {
            if (!manejarLogin.YaExisteConCorreo(user.CorreoElectronico))
            {
                casoDeUsoUsuarioAlta.Ejecutar(user);
                Navigation.NavigateTo("/login");
            }
            else
            {
                mensajeError = "Ya hay un usuario con ese correo";
            }
        }
        catch (Exception e)
        {
            mensajeError = e.Message;
        }
        finally
        {
            user = new();
        }

    }


}

<style>
    .margin {
        margin-top: 10px;
        margin-bottom: 10px;
    }

    .alineadoDer {
        align-content: ;
    }
</style>